      - name: Detect and run Node projects (root/backend/frontend)
        shell: bash
        run: |
          # 1) выключаем "exit on error" и pipefail
          set +e

          FOUND=0
          for d in "." "backend" "frontend"; do
            if [[ -f "$d/package.json" ]]; then
              echo "::group::Node project in $d"
              FOUND=1
              (
                # 2) внутри подшелла тоже без -e/pipefail
                set +e
                cd "$d"

                echo "+ npm ci || npm i"
                npm ci --no-audit --no-fund >/dev/null 2>&1 || npm i --no-audit --no-fund >/dev/null 2>&1 || true

                echo "+ npm run lint --if-present"
                npm run -s lint --if-present >/dev/null 2>&1 || true

                echo "+ npm test --if-present"
                npm -s test --if-present >/dev/null 2>&1 || true

                echo "+ npm run build --if-present"
                npm run -s build --if-present >/dev/null 2>&1 || true
              )
              echo "::endgroup::"
            fi
          done

          if [[ "$FOUND" -eq 0 ]]; then
            echo "No Node projects detected — skipping job successfully."
          fi

          # 3) гарантируем успех шага
          exit 0
